name: Duplicate Repository to mygpt-dev

on:
  push:
    branches:
      - main

jobs:
  duplicate:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2
      with:
        exclude: "amplify/team-provider-info.json"

    - name: Check if repository exists
      id: check_repo
      uses: peter-evans/repository-dispatch@v1
      with:
        token: ${{ secrets.GPT_TOKEN }}
        repository: mygpt-dev
        event-type: check-repo

    - name: Create Repository
      if: steps.check_repo.outputs.status == 'failure'
      uses: peter-evans/create-pull-request@v3
      with:
        token: ${{ secrets.GPT_TOKEN }}
        branch: main
        commit-message: "Create mygpt-dev repository"
        title: "Create mygpt-dev repository"
        body: "This is an automatically generated pull request to create the mygpt-dev repository."
        base: main
        head: main

    - name: Duplicate Repository
      uses: peter-evans/repository-dispatch@v1
      with:
        token: ${{ secrets.GPT_TOKEN }}
        repository: mygpt-dev
        event-type: duplicate
        client-payload: '{"source_repo":"mygpt-prod"}'
